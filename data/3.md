# Лекция 3: Апроксимация на цифрови честотноселективни алгоритми

**Преподавател:** доц. д-р Златка Вълкова-Джарвис

---

## СЪДЪРЖАНИЕ

**1. Нерекурсивни (КИХ) цифрови честотноселективни алгоритми**

- 1.1. КИХ филтри с линейна ФЧХ
- 1.2. Методи за проектиране
  - Метод с дискретизация на АЧХ
  - Метод с прозоречни функции
  - Методи, минимизиращи квадратичната грешка

**2. Рекурсивни (БИХ) цифрови честотноселективни алгоритми**

- 2.1. Методи за проектиране
- 2.2. Билинейно z-преобразуване
- 2.3. Метод с билинейно z-преобразуване
- 2.4. Цифрови честотни преобразувания
- 2.5. Метод с инвариантна импулсна характеристика
- 2.6. Проектиране чрез Matlab

---

## 1. НЕРЕКУРСИВНИ (КИХ) ФИЛТРИ

### Основни характеристики

**FIR** - Finite Impulse Response, Feedforward filters, All-zero filters

**Предимства:**

- ✓ **Линейна фаза**
- ✓ Винаги устойчиви
- ✓ Няма гранични цикли

**ДУ:** $y(n) = \sum_{i=0}^{M} h_i x(n-i)$

**ПФ:** $H(z) = \sum_{i=0}^{M} h_i z^{-i} = B(z)$

където:

- **М+1** – дължина на ДУ/ПФ
- **M** – ред на ДУ/ПФ

---

## 1.1. КИХ ФИЛТРИ С ЛИНЕЙНА ФЧХ

### Условия за линейна ФЧХ

**ФЧХ:** $\theta(\omega) = -\frac{M}{2}\omega T$

**ГВЗ:** $t_{GD}(\omega) = -\frac{d\theta}{d\omega} = \frac{M}{2}T = const$

**Експоненциална форма:**

$$H(e^{j\omega}) = H_r(\omega)e^{-j\frac{M}{2}\omega T}$$

където $H_r(\omega)$ - реална АЧХ

### Четири типа КИХ филтри

| Тип   | М (ред) | М+1 (дължина) | h(n)       | $\theta(0)$ | $t_{GD}$ | $H_r(0)$ | $H_r(\pi)$ | Приложение         |
| ----- | ------- | ------------- | ---------- | ----------- | -------- | -------- | ---------- | ------------------ |
| **1** | четен   | нечетен       | симетрична | 0           | цяло     | произв.  | произв.    | НЧФ, ВЧФ, ЛФ, РФ   |
| **2** | нечетен | четен         | симетрична | 0           | дробно   | произв.  | 0          | НЧФ, ЛФ            |
| **3** | четен   | нечетен       | антисим.   | π/2         | цяло     | 0        | 0          | Диф., Хилберт, ВЧФ |
| **4** | нечетен | четен         | антисим.   | π/2         | дробно   | 0        | произв.    | Диф., Хилберт      |

### АЧХ формули

**Тип 1 (М четно, симетрия):**

$$H_r(\omega) = h\left(\frac{M}{2}\right) + 2\sum_{n=0}^{\frac{M}{2}-1} h(n)\cos\left[\left(\frac{M}{2}-n\right)\omega\right]$$

**Тип 2 (М нечетно, симетрия):**

$$H_r(\omega) = 2\sum_{n=0}^{\frac{M-1}{2}} h(n)\cos\left[\left(\frac{M}{2}-n\right)\omega-\frac{\omega}{2}\right]$$

**Тип 3 (М четно, антисиметрия):**

$$H_r(\omega) = 2\sum_{n=0}^{\frac{M}{2}-1} h(n)\sin\left[\left(\frac{M}{2}-n\right)\omega\right]$$

**Тип 4 (М нечетно, антисиметрия):**

$$H_r(\omega) = 2\sum_{n=0}^{\frac{M-1}{2}} h(n)\sin\left[\left(\frac{M}{2}-n\right)\omega-\frac{\omega}{2}\right]$$

---

## 1.2. МЕТОДИ ЗА ПРОЕКТИРАНЕ НА КИХ ФИЛТРИ
```

МЕТОДИ
├── Метод с дискретизация на АЧХ
├── Метод с прозоречни функции
├── Методи, минимизиращи квадратичната грешка
│ ├── Минимизация на интегралната квадратична грешка
│ └── Минимизация на сумарната квадратична грешка
└── Оптимизационни (минимаксни) методи
├── По Чебишев (алгоритъм на Паркс-Макклелън)
└── Максимално-плоска апроксимация

```

---

## 1.2.1. МЕТОД С ДИСКРЕТИЗАЦИЯ НА АЧХ

### Алгоритъм

**1. Зададена АЧХ:** $H_d(\omega)$

**2. Дискретизация:** Определят се М+1 стойности $H_d(k)$, $k=0...M$

**3. ОДПФ:** Изчисляват се М+1 отчета на ИХ:

$$h(n) = \frac{1}{M+1}\sum_{k=0}^{M} H_d(k)e^{j\frac{2\pi}{M+1}nk}$$

**4. ПФ:** $H(z) = \sum_{n=0}^{M} h(n)z^{-n}$

---

## 1.2.2. МЕТОД С ПРОЗОРЕЧНИ ФУНКЦИИ

### Принцип

**Проблем:** Идеалната ИХ е безкрайна и некаузална

**Решение:** Умножаване с прозоречна функция

$$h_r(n) = h_d(n) \cdot W(n)$$

### Алгоритъм (5 стъпки)

1. Избор на **идеална АЧХ** $H_d(\omega)$ и **прозорец** $W(n)$

2. **ОДПФ** → безкрайна ИХ:

$$h_d(n) = \frac{1}{2\pi}\int_{-\pi}^{\pi} H_d(e^{j\omega})e^{j\omega n}d\omega$$

3. **Умножение** с прозорец → крайна ИХ:

$$h_r(n) = h_d(n) \cdot W(n)$$

4. **Транслация** → каузална система

5. **ДПФ** → реална АЧХ $H_R(\omega)$

### Прозоречни функции

**Правоъгълен:**

$$W_R(n) = \begin{cases} 1, & |n| \leq M/2 \\ 0, & \text{другаде} \end{cases}$$

**Хеминг (Hamming):**

$$W_H(n) = \begin{cases} 0.54 + 0.46\cos\frac{2\pi n}{M}, & |n| \leq M/2 \\ 0, & \text{другаде} \end{cases}$$

**Други:** Хан (Hanning), Блекман, Бартлет, Чебишев, Кайзер, Гаус, Тейлър

### Сравнение на прозорци

| Прозорец | Ширина на централния отскок | Затихване (dB) |
|----------|----------------------------|----------------|
| Правоъгълен | 4π/М | ~21 |
| Хеминг | 8π/М | ~53 |
| Блекман | 12π/М | ~74 |

**Компромис:** По-широк централен отскок → по-малки странични отскоци

---

## 1.2.3. МЕТОДИ, МИНИМИЗИРАЩИ КВАДРАТИЧНАТА ГРЕШКА

### Сумарна квадратична грешка

$$E = \sum_{k=0}^{L-1} [H_d(k) - H_r(k)]^2$$

**С тегла:**

$$E = \sum_{k=0}^{L-1} W_k[H_d(k) - H_r(k)]^2$$

### Интегрална квадратична грешка

$$E = \int_{-\omega_d/2}^{\omega_d/2} [H_d(\omega) - H_r(\omega)]^2 d\omega$$

**С теглова функция:**

$$E_p = \int_{-\omega_d/2}^{\omega_d/2} W(\omega)[H_d(\omega) - H_r(\omega)]^2 d\omega$$

---

## 2. РЕКУРСИВНИ (БИХ) ФИЛТРИ

### Основни характеристики

**IIR** - Infinite Impulse Response, Feedback filter, Pole-zero filter

**Предимства:**
- ✓ По-нисък ред за същата селективност
- ✓ Класически апроксимации (Бътъруърд, Чебишев, Кауер)

**Недостатъци:**
- ✗ Нелинейна фаза
- ✗ Могат да бъдат неустойчиви

**ДУ:** $y(n) = \sum_{i=0}^{M} b_i x(n-i) - \sum_{k=1}^{N} a_k y(n-k)$

**ПФ:** $H(z) = \frac{B(z)}{A(z)} = \frac{\sum_{i=0}^{M} b_i z^{-i}}{1 + \sum_{k=1}^{N} a_k z^{-k}}$

---

## 2.1. МЕТОДИ ЗА ПРОЕКТИРАНЕ НА БИХ ФИЛТРИ

```

МЕТОДИ
├── Чрез аналого-цифрово преобразуване
│ ├── Билинейно z-преобразуване
│ ├── Инвариантна импулсна характеристика
│ └── Апроксимация на производните
└── Оптимизационни и директни методи

````

---

## 2.2. БИЛИНЕЙНО Z-ПРЕОБРАЗУВАНЕ

### Връзка s ↔ z

**От z към s:**

$$s = \frac{1}{T}\ln z = \frac{1}{T}\ln\frac{1+\tau}{1-\tau}$$

където $\tau = z^{-1}$

**Разложение в ред:**

$$s = \frac{1}{T}\left(\tau + \frac{\tau^3}{3} + \frac{\tau^5}{5} + ...\right) \approx \frac{2}{T}\frac{1-z^{-1}}{1+z^{-1}}$$

### Билинейно z-преобразуване

**От s към z:**

$$z = \frac{1 + \frac{sT}{2}}{1 - \frac{sT}{2}}$$

**От z към s:**

$$s = \frac{2}{T}\frac{1-z^{-1}}{1+z^{-1}} = \frac{2}{T}\frac{z-1}{z+1}$$

### Честотно изкривяване (warping)

**Връзка между честоти:**

$$\Omega = \frac{2}{T}\tan\frac{\omega T}{2}$$

**Обратно:**

$$\omega = \frac{2}{T}\arctan\frac{\Omega T}{2}$$

**За малки честоти:** $\Omega \approx \omega$ (линейна връзка)

**За високи честоти:** Нелинейно изкривяване

---

## 2.3. МЕТОД С БИЛИНЕЙНО Z-ПРЕОБРАЗУВАНЕ

### Два подхода

#### А. Проектиране с предизкривявания

**Стъпки:**
1. Задаване на цифров габарит
2. **Предизкривяване:** $\Omega = \frac{2}{T}\tan\frac{\omega T}{2}$
3. Преобразуване в габарит на аналогов НЧФП
4. Аналогова апроксимация → $T(S)$
5. Аналогово честотно преобразуване → $T(s)$
6. **Билинейно z-преобразуване** → $H(z)$

#### Б. Проектиране с цифрови честотни преобразувания

**Стъпки:**
1. Задаване на цифров габарит
2. Предизкривяване
3. Преобразуване в габарит на аналогов НЧФП
4. Аналогова апроксимация → $T(S)$
5. **Билинейно z-преобразуване** → $H(Z)$ (цифров НЧФП)
6. **Цифрово честотно преобразуване** → $H(z)$

---

## 2.4. ЦИФРОВИ ЧЕСТОТНИ ПРЕОБРАЗУВАНИЯ

### Трансформации на Константинидес

**НЧФП → НЧФ (LP-LP):**

$$Z^{-1} = \frac{\sin\frac{\Omega_p - \omega_p}{2}}{\sin\frac{\Omega_p + \omega_p}{2}} \cdot \frac{z^{-1} - \alpha}{1 - \alpha z^{-1}}$$

където $\alpha = \frac{\sin\frac{\omega_p T}{2}}{\sin\frac{\Omega_p T}{2}}$

**НЧФП → ВЧФ (LP-HP):**

$$Z^{-1} = -\frac{z^{-1} + \alpha}{1 + \alpha z^{-1}}$$

**НЧФП → ЛФ (LP-BP):**

$$Z^{-1} = -\frac{z^{-2} - \beta_1 z^{-1} + \beta_2}{1 - \beta_1 z^{-1} + \beta_2 z^{-2}}$$

където:

$$\beta_1 = \frac{\cos\frac{\omega_{p1} + \omega_{p2}}{2}}{\cos\frac{\omega_{p1} - \omega_{p2}}{2}}$$

$$\beta_2 = \frac{\tan\frac{\Omega_p T}{2} - \tan\frac{\omega_{p1} - \omega_{p2}}{4}}{\tan\frac{\Omega_p T}{2} + \tan\frac{\omega_{p1} - \omega_{p2}}{4}}$$

**НЧФП → РФ (LP-BS):**

$$Z^{-1} = \frac{z^{-2} + \beta_1 z^{-1} + \beta_2}{1 + \beta_1 z^{-1} + \beta_2 z^{-2}}$$

---

## 2.5. МЕТОД С ИНВАРИАНТНА ИМПУЛСНА ХАРАКТЕРИСТИКА

### Принцип

**Цел:** Запазване на формата на ИХ при дискретизация

$$h(nT) = T \cdot h_a(t)|_{t=nT}$$

където T - период на дискретизация

### Алгоритъм

**1. Аналогова ПФ:** $T(s)$

**2. Обратно преобразуване на Лаплас:** $h_a(t) = \mathcal{L}^{-1}[T(s)]$

**3. Мащабиране и дискретизация:** $h(nT) = T \cdot h_a(nT)$

**4. Z-преобразуване:** $H(z) = \mathcal{Z}[h(nT)]$

### Пример

**Дадено:** $T(s) = \frac{2}{s+2}$, $f_d = 10$ Hz

**Решение:**

$$h_a(t) = 2e^{-2t}u(t)$$

$$h(nT) = T \cdot h_a(nT) = 0.1 \cdot 2e^{-0.2n}u(n) = 0.2e^{-0.2n}u(n)$$

$$H(z) = \frac{0.2z^{-1}}{1 - 0.8187z^{-1}}$$

**Недостатък:** Възможно честотно препокриване (aliasing)

---

## 2.6. ПРОЕКТИРАНЕ ЧРЕЗ MATLAB

### Пример 1: Цифров НЧФ по Чебишев

```matlab
% Спецификации
Rp=3; Rs=35; wd=2000;
wp=300/(wd/2);  % wp = 0.3000
ws=600/(wd/2);  % ws = 0.6000

% Изчисляване на ред
[N, wn] = cheb1ord(wp, ws, Rp, Rs);  % N=3

% Проектиране
[B1, A1] = cheby1(N, Rp, wn);
````

**Резултат:**

$$H(z) = \frac{0.021 + 0.063z^{-1} + 0.063z^{-2} + 0.021z^{-3}}{1 - 1.878z^{-1} + 1.618z^{-2} - 0.5724z^{-3}}$$

### Пример 2: Цифров ВЧФ по Кауер

```matlab
% Аналогов габарит
Rp=2; Rs=40; Wp=2200; Ws=1000;
[N, Wn] = ellipord(Wp, Ws, Rp, Rs, 's');

% Аналогова апроксимация
[Ns, Ds] = ellip(N, Rp, Rs, Wn, 'high', 's');

% Билинейно преобразуване
wd=6000; fd=wd/(2*pi);
[B, A] = bilinear(Ns, Ds, fd);
```

### Пример 3: ЛФ чрез цифрови преобразувания

```matlab
% НЧФП по Бътъруърд
N=4;
[z, p, k] = buttap(N);
[NS, DS] = zp2tf(z, p, k);

% Билинейно към цифров НЧФП
fd=477.4648;
[BZ, AZ] = bilinear(NS, DS, fd/(fd/2));

% Преобразуване LP→BP
wp1=480; wp2=720;  % rad/s
Wo=0.1559;
[B, A] = iirlp2bp(BZ, AZ, Wo, [wp1n wp2n]);
```

---

## СРАВНЕНИЕ НА МЕТОДИ

| Метод               | КИХ/БИХ | Линейна фаза | Сложност | Устойчивост       |
| ------------------- | ------- | ------------ | -------- | ----------------- |
| Прозоречни функции  | КИХ     | ✓            | Ниска    | Винаги            |
| Паркс-Макклелън     | КИХ     | ✓            | Средна   | Винаги            |
| Билинейно z-преобр. | БИХ     | ✗            | Висока   | Гарантирана       |
| Инвариантна ИХ      | БИХ     | ✗            | Средна   | Възможно aliasing |

---

## ОСНОВНИ ФОРМУЛИ

**Билинейно z-преобразуване:**
$$s = \frac{2}{T}\frac{1-z^{-1}}{1+z^{-1}}$$

**Честотно изкривяване:**
$$\Omega = \frac{2}{T}\tan\frac{\omega T}{2}$$

**ГВЗ за линейна фаза:**
$$t_{GD} = \frac{M}{2}T = const$$

---
### Question 1
Кой от следните методи НЕ се използва за проектиране на КИХ филтри?

A. Билинейно z-преобразуване
B. Метод с прозоречни функции
C. Метод с дискретизация на АЧХ
D. Методи, минимизиращи квадратичната грешка
Correct: A

### Question 2
Какво е основното предимство на линейната фазова характеристика при КИХ филтрите?

A. Постоянно групово време на закъснение
B. По-добра честотна селективност
C. По-нисък ред на филтъра
D. По-малко изчислителни операции
Correct: A

### Question 3
Кой от четирите типа КИХ филтри има симетрична импулсна характеристика и нечетен ред?

A. Тип 1 (М четен, h(n) симетрична)
B. Тип 2 (М нечетен, h(n) симетрична)
C. Тип 3 (М четен, h(n) антисиметрична)
D. Тип 4 (М нечетен, h(n) антисиметрична)
Correct: B

### Question 4
Кой тип КИХ филтър е подходящ за проектиране на диференциатор и Хилбертова трансформация?

A. Тип 3 и Тип 4 (антисиметрични)
B. Тип 1 и Тип 2 (симетрични)
C. Само Тип 1
D. Само Тип 2
Correct: A

### Question 5
Каква е основната идея на метода с прозоречни функции?

A. Умножаване на безкрайната идеална ИХ с крайна прозоречна функция
B. Директна дискретизация на желаната АЧХ
C. Минимизиране на квадратичната грешка
D. Използване на билинейно преобразуване
Correct: A

### Question 6
Коя формула описва билинейното z-преобразуване?

A. $s = \frac{2}{T}\frac{1-z^{-1}}{1+z^{-1}}$
B. $s = \frac{T}{2}\frac{1+z^{-1}}{1-z^{-1}}$
C. $z = e^{j\omega T}$
D. $s = j\omega$
Correct: A

### Question 7
Какво представлява честотното изкривяване при билинейното z-преобразуване?

A. $\Omega = \frac{2}{T}\tan\frac{\omega T}{2}$
B. $\Omega = \frac{2}{T}\sin\frac{\omega T}{2}$
C. $\Omega = \frac{T}{2}\tan\omega T$
D. $\Omega = \omega$
Correct: A

### Question 8
Кой от следните методи гарантира оптимална апроксимация в минимаксен смисъл за КИХ филтри?

A. Алгоритъм на Паркс-Макклелън (Чебишов)
B. Метод с прозоречни функции
C. Метод с дискретизация на АЧХ
D. Метод с инвариантна импулсна характеристика
Correct: A

### Question 9
Кога КИХ филтър от Тип 2 е подходящ за проектиране?

A. За нискочестотни филтри с четен брой коефициенти
B. За високочестотни филтри
C. За лентови филтри
D. За режекторни филтри
Correct: A

### Question 10
Какво е основното предимство на метода с инвариантна импулсна характеристика?

A. Запазва формата на импулсната характеристика на аналоговия филтър
B. Осигурява линейна фазова характеристика
C. Изисква по-малко изчисления
D. Винаги дава устойчиви цифрови филтри
Correct: A

### Question 11
Кой от следните фактори определя избора на прозоречна функция при проектиране на КИХ филтри?

A. Компромис между ширина на преходна област и амплитуда на отскоци
B. Само реда на филтъра
C. Само честотата на дискретизация
D. Само типа на филтъра (НЧФ, ВЧФ, ЛФ, РФ)
Correct: A

### Question 12
Какъв е резултатът от умножаването на идеалната ИХ с прозоречна функция?

A. Намаляване на страничните ленти (Гибс явление)
B. Увеличаване на честотната селективност
C. Подобряване на линейността на фазата
D. Увеличаване на реда на филтъра
Correct: A

### Question 13
Кой метод за проектиране на БИХ филтри е най-подходящ за преобразуване на аналогови прототипи?

A. Билинейно z-преобразуване
B. Метод с прозоречни функции
C. Метод с дискретизация на АЧХ
D. Алгоритъм на Паркс-Макклелън
Correct: A

### Question 14
Какво е основното ограничение на метода с инвариантна импулсна характеристика?

A. Възможен aliasing ефект
B. Не може да проектира филтри с линейна фаза
C. Изисква висок ред на филтъра
D. Не гарантира устойчивост
Correct: A

### Question 15
Кога се използва максимално-плоска апроксимация (Батъруърт)?

A. Когато се желае максимално плоска АЧХ в лентата на пропускане
B. Когато се желае най-стръмна преходна област
C. Когато се желае минимална фазова изкривеност
D. Когато се желае минимален ред на филтъра
Correct: A

### Question 16
Какво представлява алгоритъмът на Паркс-Макклелън?

A. Итеративен метод за минимаксна апроксимация на КИХ филтри
B. Метод за проектиране на БИХ филтри
C. Вид прозоречна функция
D. Метод за дискретизация на АЧХ
Correct: A

### Question 17
Кой от следните методи осигурява линейна фазова характеристика? (Select all that apply)

A. Метод с прозоречни функции
B. Метод с дискретизация на АЧХ
C. Билинейно z-преобразуване
D. Метод с инвариантна импулсна характеристика
Correct: A, B

### Question 18
Какво е основното предимство на елиптичните филтри (Кауър)?

A. Минимален ред за дадени спецификации
B. Линейна фазова характеристика
C. Максимално плоска АЧХ
D. Най-лесна реализация
Correct: A

### Question 19
Кой от следните параметри се влияе от избора на прозоречна функция?

A. Ширина на преходна област и амплитуда на страничните ленти
B. Централна честота на филтъра
C. Честота на дискретизация
D. Стабилност на системата
Correct: A

### Question 20
Кога КИХ филтрите са предпочитани пред БИХ филтрите? (Select all that apply)

A. Когато е нужна линейна фазова характеристика
B. Когато се изисква гарантирана устойчивост
C. Когато няма ограничение за изчислителната сложност
D. Когато се проектират от аналогови прототипи
Correct: A, B, C
---
