# Лекция 4: Реализация на системи за ЦОС. Паразитни ефекти

**Преподавател:** доц. д-р Златка Вълкова-Джарвис

---

## СЪДЪРЖАНИЕ

1. Цифрови системи – практическа реализация
2. Двоични числа – представяне, динамичен диапазон, нормиране
3. Двоични числа с фиксирана запетая - прав, обратен и допълнителен код
4. Квантуване на двоични числа с ФЗ чрез отсичане и закръгление - грешка от квантуване
5. Статистически оценки на грешката от квантуване
6. Цифрови реализации с ФЗ – паразитни ефекти

---

## 1. ЦИФРОВИ СИСТЕМИ – ПРАКТИЧЕСКА РЕАЛИЗАЦИЯ

### Основни компоненти

**Пример за рекурсивна система I ред:**

$$H(z) = \frac{b_1 + z^{-1}}{1 + a_1z^{-1}}$$

$$x(n) = b_1x(n) + a_1y(n-1)$$

**Компоненти:**

- **АЦП** - преобразува аналогов сигнал в двоичен код
- **Умножители** - работят с двоични числа (напр. $a_1 = 0.53125_{10} = 0◊10001_2$)
- **ЦАП** - преобразува двоичен код в аналогов сигнал

---

## 2. ДВОИЧНИ ЧИСЛА – ПРЕДСТАВЯНЕ

### Основни понятия

**Двоично число:**

$$N = \sum_{i=-m}^{n} b_i \cdot r^i, \quad b_i \in \{0,1\}, \quad r=2$$

**Логически нива:**

- **HIGH** = 5V = True = On = 1
- **LOW** = 0V = False = Off = 0

**Бит (bit)** - binary digit

- **MSB** - Most Significant Bit (старши бит)
- **LSB** - Least Significant Bit (младши бит)

**Размери на двоични думи:**

- **Байт** - 8 bits
- **Дума (Word)** - 16 bits
- **Двойна дума** - 32 bits
- **Дълга дума** - 64 bits

### Двоични числа с фиксирана запетая (ФЗ)

**Структура:**

- **Бит за знак** (1 bit)
- **Информационни битове** (B-1 bits)
- **Дължина на дума:** B = n + m + 1

**Два типа:**

**1. Дясно фиксирана запетая (цели числа):**

$$N = c_{n-1}c_{n-2}...c_2c_1c_0 \cdot$$

- Диапазон със знак: $\pm(2^{B-1}-1)$
- Пример: B=8 → [-127 ÷ +127]

**2. Ляво фиксирана запетая (дробни числа):**

$$N = \cdot c_{-1}c_{-2}...c_{-m}$$

- Диапазон със знак: $\pm(1-2^{-(B-1)})$
- Пример: B=8 → [-0.9921875 ÷ +0.9921875]

### Резолюция (стъпка на квантуване)

**Дясно ФЗ:** $\delta = 1$

**Ляво ФЗ:** $\delta = 2^{-B} = 2^{-(B-1)}$ (без знаков бит)

### Динамичен диапазон

$$D_{ФЗ} = 20\lg\frac{2^{B-1}}{1} = 20\lg(2^{B-1}) \approx 6.02 \cdot B \text{ dB}$$

**Правило:** Динамичният диапазон е **6 dB за bit**

**Пример:** B=8 bits → $D_{ФЗ} = 6.02 \times 7 = 42.14$ dB

### Нормиране на коефициенти

**Цел:** Всички коефициенти в ПФ да са в диапазона [-1, 1]

**Стъпки:**

1. Намери най-големия коефициент по модул
2. Изчисли реципрочната стойност β
3. Избери $\alpha = 2^{-i}$ най-близко до β, без да го надвишава
4. Умножи всички коефициенти с α

**Пример:**

$$H(z) = \frac{1 + 0.3224z^{-1} + 0.7052z^{-2}}{1 - 1.268z^{-1} + 1.878z^{-1} - 1.618z^{-3}}$$

- Най-голям: $|b_1| = 1.268$
- $\beta = 1/1.268 = 0.7886$
- $\alpha = 2^{-1} = 0.5$

---

## 3. ДВОИЧНИ ЧИСЛА С ФИКСИРАНА ЗАПЕТАЯ - КОДОВЕ

### Преобразуване десетично → двоично

**Цяла част:** Дели на 2, остатъците в **обратен ред**

**Дробна част:** Умножава по 2, цялата част в **прав ред**

**Пример:** $-10.4375_{10}$ → $11010◊01110_2$

### Три основни кода

#### 1. Прав код (Sign-Magnitude)

$$N_{ПК} = \begin{cases} 0b_{B-2}...b_1b_0, & N \geq 0 \\ 1b_{B-2}...b_1b_0, & N < 0 \end{cases}$$

- Диапазон: $\pm(2^{B-1}-1)$
- **Недостатък:** Две представяния на нула (±0)

#### 2. Обратен код (One's Complement)

$$N_{ОК} = \begin{cases} N_{ПК}, & N \geq 0 \\ 2^B - 2 - N_{ПК}, & N < 0 \end{cases}$$

- Инвертират се всички битове (0↔1)
- Диапазон: $\pm(2^{B-1}-1)$
- **Недостатък:** Две представяния на нула

#### 3. Допълнителен код (Two's Complement)

$$N_{ДК} = \begin{cases} N_{ПК}, & N \geq 0 \\ 2^B - N_{ПК}, & N < 0 \end{cases}$$

или: $N_{ДК} = N_{ОК} + 1$

- Диапазон: $[-2^{B-1} \div (2^{B-1}-1)]$
- **Предимство:** Едно представяне на нула
- **Най-използван в практиката**

### Сравнителна таблица (B=4 bits)

| Десетично | Прав код | Обратен код | Допълнителен код |
| --------- | -------- | ----------- | ---------------- |
| +7        | 0111     | 0111        | 0111             |
| +3        | 0011     | 0011        | 0011             |
| +1        | 0001     | 0001        | 0001             |
| 0         | 0000     | 0000        | 0000             |
| -0        | 1000     | 1111        | -                |
| -1        | 1001     | 1110        | 1111             |
| -3        | 1011     | 1100        | 1101             |
| -7        | 1111     | 1000        | 1001             |
| -8        | -        | -           | 1000             |

---

## 4. КВАНТУВАНЕ НА ДВОИЧНИ ЧИСЛА

### Процес на квантуване

**Вход:** Безкрайна точност или L bits (L>B)  
**Изход:** B bits

**Грешка от квантуване:** $e = N_q - N$

**Стъпка на квантуване:** $\delta = 2^{-B}$

### Два метода на квантуване

#### 1. Отсичане (Truncation)

Отстраняват се всички битове извън регистъра (избира се по-малкото по абсолютна стойност ниво)

**Прав и обратен код:**

- Положителни: $-\delta \leq e \leq 0$
- Отрицателни: $0 \leq e \leq \delta$

**Допълнителен код:**

- Положителни: $-\delta \leq e \leq 0$
- Отрицателни: $-\delta \leq e \leq 0$

**Максимална грешка:** $|e|_{max} = \delta = 2^{-B}$

#### 2. Закръгление (Rounding)

Избира се най-близкото разрешено ниво

**Всички кодове:**

- $-\delta/2 \leq e \leq \delta/2$

**Максимална грешка:** $|e|_{max} = \delta/2 = 0.5 \cdot 2^{-B}$

---

## 5. СТАТИСТИЧЕСКИ ОЦЕНКИ НА ГРЕШКАТА

### Условия за линеен модел

1. e(n) е **стационарен** случаен процес, **некорелиран** с x(n)
2. e(n) е **независим** процес без взаимна корелация
3. P(e) има **равномерно разпределение** в интервал δ

### Шумов модел

```
x(n) → [+] → x_q(n) = x(n) + e(n)
         ↑
       e(n)
```

### Дисперсия на шума от квантуване

**Закръгление (всички кодове):**

$$\sigma_e^2 = \frac{\delta^2}{12} = \frac{2^{-2B}}{12}$$

- Средна стойност: $m_q = 0$
- Интервал: $[-\delta/2 \div \delta/2]$

**Отсичане (допълнителен код):**

$$\sigma_e^2 = \frac{\delta^2}{12} = \frac{2^{-2B}}{12}$$

- Средна стойност: $m_q = -\delta/2$
- Интервал: $[-\delta \div 0]$

**Отсичане (прав, обратен код):**

$$\sigma_e^2 = \frac{\delta^2}{3} = \frac{2^{-2B}}{3}$$

- Интервал: $[-\delta \div 0]$ или $[0 \div \delta]$

### Отношение сигнал-шум (SNR)

$$SNR = 10\lg\frac{\sigma_x^2}{\sigma_e^2} \text{ dB}$$

**Закръгление:**

$$SNR = 10\lg\sigma_x^2 + 10.8 + 6.02B \text{ dB}$$

**Отсичане (допълнителен):**

$$SNR = 10\lg\sigma_x^2 + 10.8 + 6.02B \text{ dB}$$

**Отсичане (прав, обратен):**

$$SNR = 10\lg\sigma_x^2 + 4.77 + 6.02B \text{ dB}$$

**Разлика:** $10.8 - 4.77 = 6.03$ dB

---

## 6. ЦИФРОВИ РЕАЛИЗАЦИИ С ФЗ – ПАРАЗИТНИ ЕФЕКТИ

### Идеална система (без паразитни ефекти)

$$y(n) = x(n) + ay(n-1)$$

$$H(z) = \frac{1}{1 - az^{-1}}$$

- Безкрайна дължина на двоичната дума
- Абсолютно тиха - без шумове и изкривявания

### Реална система (с паразитни ефекти)

**Квантуващи устройства:**

- **Q_I** - квантува входния сигнал x(n)
- **Q_A** - квантува коефициента a
- **Q_V** - квантува произведението v(n) = ay(n-1)
- **Q_O** - квантува изходния сигнал y(n)

### Видове паразитни ефекти

1. **Препълване на регистрите** (overflow)
2. **Квантуване на сигнали**
3. **Ефекти от квантуване на умножителите**
4. **Квантуване на произведенията**
5. **Гранични цикли** (limit cycles)

### Методи за намаляване на паразитните ефекти

✓ **Мащабиране** на входния сигнал или коефициенти  
✓ **Увеличаване дължината** на двоичната дума  
✓ **Избор на подходяща структура** (каскадна е най-добра)

---

## ОСНОВНИ ФОРМУЛИ

**Динамичен диапазон:**
$$D_{ФЗ} \approx 6.02 \cdot B \text{ dB}$$

**Стъпка на квантуване:**
$$\delta = 2^{-B}$$

**Дисперсия (закръгление):**
$$\sigma_e^2 = \frac{\delta^2}{12}$$

**SNR:**
$$SNR = 10\lg\sigma_x^2 + 10.8 + 6.02B \text{ dB}$$

---

## ОСНОВНИ ТЕРМИНИ

- **ФЗ** - Фиксирана запетая
- **MSB** - Most Significant Bit
- **LSB** - Least Significant Bit
- **ПК** - Прав код
- **ОК** - Обратен код
- **ДК** - Допълнителен код
- **SNR** - Signal-to-Noise Ratio
- **АЦП** - Аналогово-цифров преобразувател
- **ЦАП** - Цифрово-аналогов преобразувател

---
### Въпрос 1
Каква е основната цел на мащабирането на коефициентите при цифрова реализация?

A. Всички коефициенти да са в диапазона [-1, 1]
B. Да се увеличи динамичният диапазон
C. Да се намали изчислителната сложност
D. Да се подобри честотната характеристика
Correct: A

### Въпрос 2
Кой от следните кодове има две представяния на нула?

A. Прав код и обратен код
B. Допълнителен код
C. Само прав код
D. Само обратен код
Correct: A

### Въпрос 3
Какъв е основният недостатък на правия код при представяне на отрицателни числа?

A. Има две представяния на нула
B. По-сложна аритметика
C. По-малък динамичен диапазон
D. Нестабилни изчисления
Correct: A

### Въпрос 4
Кой код е най-използван в практиката за представяне на числа с фиксирана запетая?

A. Допълнителен код (two's complement)
B. Прав код (sign-magnitude)
C. Обратен код (one's complement)
D. Десетичен код
Correct: A

### Въпрос 5
Каква е стъпката на квантуване при B бита?

A. $\delta = 2^{-B}$
B. $\delta = 2^{B}$
C. $\delta = B^{-2}$
D. $\delta = \frac{1}{B}$
Correct: A

### Въпрос 6
Кой метод за квантуване дава по-малка средноквадратична грешка?

A. Закръгляне
B. Отсичане
C. Нормиране
D. Мащабиране
Correct: A

### Въпрос 7
Каква е приблизителната връзка между битовете и динамичен диапазон в децибели?

A. $D_{ФЗ} \approx 6.02 \cdot B$ dB
B. $D_{ФЗ} \approx 3.01 \cdot B$ dB
C. $D_{ФЗ} \approx 12.04 \cdot B$ dB
D. $D_{ФЗ} \approx B$ dB
Correct: A

### Въпрос 8
Какво представлява MSB (Most Significant Bit)?

A. Битът с най-голяма тежест в двоичното число
B. Първият бит отляво
C. Битът, който определя знака
D. Последният бит отдясно
Correct: A

### Въпрос 9
Кой от следните компоненти НЕ е част от реализацията на цифров филтър?

A. Аналогов филтър
B. АЦП (Аналогово-цифров преобразувател)
C. Умножители
D. ЦАП (Цифрово-аналогов преобразувател)
Correct: A

### Въпрос 10
Какъв е основният източник на паразитни ефекти в цифровите системи?

A. Крайна дължина на двоичните числа и квантуване
B. Аналогови компоненти
C. Прекалено висока честота на дискретизация
D. Лош избор на структура на филтъра
Correct: A

### Въпрос 11
Какво е основното предимство на каскадната структура при реализация?

A. По-добра устойчивост на паразитни ефекти
B. По-малко изчислителни операции
C. По-нисък ред на системата
D. Линейна фазова характеристика
Correct: A

### Въпрос 12
Кога се получава ефект на препълване (overflow) в цифровите системи?

A. Когато резултатът от изчисление надхвърли дължината на регистъра
B. Когато входният сигнал е твърде голям
C. Когато честотата на дискретизация е твърде ниска
D. Когато коефициентите са твърде малки
Correct: A

### Въпрос 13
Какво представлява граничен цикъл (limit cycle) в цифровите филтри?

A. Периодични колебания на изхода при нулев вход
B. Непрекъсно нарастващ сигнал
C. Хаотични колебания
D. Постоянен изходен сигнал
Correct: A

### Въпрос 14
Кой от следните методи помага за намаляване на паразитните ефекти? (Select all that apply)

A. Мащабиране на входния сигнал или коефициенти
B. Увеличаване дължината на двоичната дума
C. Избор на подходяща структура (каскадна)
D. Намаляване на честотата на дискретизация
Correct: A, B, C

### Въпрос 15
Каква е дисперсията на грешката при квантуване чрез закръгляне?

A. $\sigma_e^2 = \frac{\delta^2}{12}$
B. $\sigma_e^2 = \frac{\delta}{2}$
C. $\sigma_e^2 = \delta^2$
D. $\sigma_e^2 = \frac{\delta}{\sqrt{12}}$
Correct: A

### Въпрос 16
Какво представлява SNR (Signal-to-Noise Ratio) при квантуване?

A. Отношението сигнал/шум, измерено в децибели
B. Отношението мощност/честота
C. Отношението усилване/затихване
D. Отношението вход/изход
Correct: A

### Въпрос 17
Кой вид квантуване дава грешка в диапазона $[-\delta/2, \delta/2]$?

A. Закръгляне
B. Отсичане
C. Нормиране
D. Мащабиране
Correct: A

### Въпрос 18
Как се преобразува отрицателно число в допълнителен код?

A. Инвертират се всички битове и се добавя 1
B. Инвертират се всички битове
C. Променя се само знаковия бит
D. Добавя се 1 към правия код
Correct: A

### Въпрос 19
Кой от следните параметри определя точността на цифровата система?

A. Бройте битове в представянето (B)
B. Честотата на дискретизация
C. Редът на филтъра
D. Типът на филтъра (КИХ/БИХ)
Correct: A

### Въпрос 20
Какво е основното предимство на използването на числа с плаваща запетая спрямо фиксирана?

A. По-голям динамичен диапазон
B. По-бързи изчисления
C. По-стабилни изчисления
D. По-проста реализация
Correct: A
---
