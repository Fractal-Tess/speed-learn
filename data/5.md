# Лекция 5: Паразитни ефекти от квантуване на коефициентите на умножение и произведенията. Препълвания и гранични цикли

**Преподавател:** доц. д-р Златка Вълкова-Джарвис

---

## СЪДЪРЖАНИЕ

1. Квантуване на коефициентите на умножение
   - 1.1. Същност и начини за намаляване на ефектите
   - 1.2. Квантуване на умножителите на нерекурсивни системи
2. Препълвания при реализация на цифрови системи
   - 2.1. Мащабиране на нерекурсивни системи
   - 2.2. Мащабиране на рекурсивни системи
   - 2.3. Гранични цикли от препълване
3. Шум от квантуване на произведенията
   - 3.1. Линеен шумов модел
   - 3.2. Оценка на шума
   - 3.3. Гранични цикли с ниски нива

---

## 1. КВАНТУВАНЕ НА КОЕФИЦИЕНТИТЕ НА УМНОЖЕНИЕ

### Същност на проблема

**Преди квантуване:** $b_i, a_k, h_l$ (безкрайна точност или L bits)

**След квантуване:** $\hat{b}_i, \hat{a}_k, \hat{h}_l$ (B bits)

**Ефекти:**

- Отместване на **полюсите** и **нулите** в z-равнината
- Промяна на **АЧХ** и **ФЧХ**
- Възможна **загуба на устойчивост**

### Методи за намаляване на ефектите

#### 1. Увеличаване на дължината на двоичната дума

**Минимална дължина за рекурсивни системи:**

$$B_{min} = \log_2|\delta_p| + \log_2|\omega_p - \omega_s| + \log_2\left|\frac{2}{\omega_d \sin\frac{\omega_p}{\omega_d}}\right|$$

където:

- $\delta_p$ - максимални отскоци в ЛП
- $\omega_p - \omega_s$ - ширина на преходната област
- $\omega_d$ - честота на дискретизация

**Условие:** $\Delta H(\omega) \leq \Delta H_{max}(\omega)$

#### 2. Утежняване на изискванията (габарита)

- Намаляване на $\delta_p$ и $\delta_s$
- Стесняване на преходната област
- Води до **по-висок ред** на филтъра

#### 3. Използване на схеми с ниски чувствителности

**LS1a-звено (НЧФ):**

$$H_{LS1a}^{НЧ}(z) = \frac{0.5(1 + z^{-1})}{1 - \alpha z^{-1}}$$

**LS1a-звено (ВЧФ):**

$$H_{LS1a}^{ВЧ}(z) = \frac{0.5(1 - z^{-1})}{1 - \alpha z^{-1}}$$

**MHNS-звено:** Минимална чувствителност при $\alpha \approx 1$

#### 4. Избор на подходяща схемна реализация

**Каскадна реализация >> Директна реализация**

**Пример за ВЧФ по Кауер:**

$$H(z) = \frac{0.1081 - 0.2452z^{-1} + 0.2452z^{-2} - 0.1081z^{-3}}{1 - 0.8113z^{-1} + 0.8628z^{-2} - 0.344z^{-3}}$$

При квантуване до 4 bits:

- **Директна:** Голямо отместване на полюси/нули, неустойчивост
- **Каскадна:** Малко отместване, запазена устойчивост

---

## 1.2. Квантуване на нерекурсивни системи

### Шумов модел

$$\hat{H}(z) = H(z) + \Delta H(z)$$

където $\Delta H(z)$ - шумова ПФ

### Дисперсия на шума

$$\sigma_{\Delta H}^2 = (M+1)\sigma_e^2 = (M+1)\frac{2^{-2B}}{12}$$

**Условия за линеен модел:**

1. $\Delta h_l$ е бял Гаусов процес
2. Отчетите са некорелирани
3. Равномерно разпределение

### Каскадна реализация (КИХ)

$$H(z) = b_0 H_0(z)H_1(z)H_2(z)\ldots H_R(z)$$

**Линейна ФЧХ се запазва** след квантуване

---

## 2. ПРЕПЪЛВАНИЯ ПРИ РЕАЛИЗАЦИЯ

### Видове проблеми

**Препълване (overflow):** Загуба на най-старши бит

**Ненапълване (underflow):** Резултат → 0

### Мащабиране

**Цел:** $|y(n)| \leq 1$ за $|x(n)| \leq X_{max}$

**Мащабиращ коефициент:**

$$K = \frac{1}{G}$$

където G - норма на системата

### Норми

**l₁-норма:**

$$G = l_1 = \sum_{i=0}^{M} |h_i|$$

**l₂-норма:**

$$G = l_2 = \sqrt{\sum_{i=0}^{M} h_i^2}$$

**l∞-норма:**

$$G = l_\infty = \max_\omega |H(e^{j\omega})|$$

---

## 2.1. Мащабиране на нерекурсивни системи

### Директна реализация

**Пример:** $y(n) = 0.3x(n) - 0.1x(n-1) + 0.4x(n-2) + 0.25x(n-3)$

$$G = |0.3| + |-0.1| + |0.4| + |0.25| = 1.05$$

$$K = \frac{1}{1.05} \approx 0.952$$

**Ефект на мащабирането:**

- $\sigma_{y,мащ}^2 = K^2 \sigma_{y}^2$
- Намалява се шумът на изхода

### Каскадна реализация

**Мащабиране с най-голяма норма:**

Всяко звено се мащабира с $G_i = \max_j G_j$

**Последователно мащабиране:**

Всяко звено се мащабира индивидуално с $1/G_i$

---

## 2.2. Мащабиране на рекурсивни системи

### Система от I ред

$$H(z) = \frac{1}{1 - az^{-1}}, \quad h(n) = a^n u(n)$$

**l₁-норма:**

$$G = \sum_{n=0}^{\infty} |a|^n = \frac{1}{1-|a|}$$

**Условие за $a=0.975$:**

$$G = \frac{1}{1-0.975} = 40$$

### Каскадна рекурсивна реализация

**Мащабираща ПФ:**

$$F_r(z) = \frac{1}{G_r} \cdot \frac{D_r(z)}{D_1(z)D_2(z)\ldots D_r(z)}$$

**Стратегия:**

1. Определи точки на препълване
2. Изчисли $F_r(z)$ за всяка точка
3. Изчисли норми $G_r$
4. Мащабирай коефициентите:
   - $K \rightarrow K/G_1$
   - $b_{i1} \rightarrow b_{i1}/(G_2/G_1)$
   - $b_{i2} \rightarrow b_{i2}/(G_3/G_2)$

---

## 2.3. Гранични цикли от препълване

### Характеристики

- Възникват при **препълване в суматорите**
- **Високо ниво** на осцилации
- **Неустойчиво** поведение

### Методи за предотвратяване

**1. Отсичане вместо закръгление** (прав код)

**2. Мащабиране с l₁-норма** (гарантирано без препълване)

**3. Суматори с насищане:**

```
if (x > 1)  y = 1
if (x < -1) y = -1
else        y = x
```

**4. "Нискокачествени" системи:**

Условие: $a_1 + a_2 < 1$ (за звено от II ред)

---

## 3. ШУМ ОТ КВАНТУВАНЕ НА ПРОИЗВЕДЕНИЯТА

### Линеен шумов модел

**Произведение:**

$$\hat{v}(n) = au(n) + e(n)$$

където:

- $u(n)$ - B bits
- $a$ - B bits
- $\hat{v}(n)$ - 2B bits → квантуване до B bits
- $e(n)$ - шум от квантуване

### Условия за линейност

1. $u(n)$ и $e(n)$ **некорелирани**
2. $e(n)$ - **независими дискрети**
3. $e(n)$ - **стационарен бял шум** с равномерно разпределение

---

## 3.2. Оценка на шума

### Дисперсия на шума от един умножител

$$\sigma_i^2 = \sigma_e^2 \cdot \frac{1}{2\pi j}\oint_C G_i(z)G_i(z^{-1})z^{-1}dz$$

където $G_i(z)$ - парциална ПФ от i-тия умножител до изхода

### Сумарна мощност на шума

$$\sigma_\Sigma^2 = \sum_{i=1}^{L} \sigma_i^2 = \frac{\sigma_e^2}{12}\sum_{i=1}^{L} \frac{1}{2^{2B}}$$

**Нормирана мощност:**

$$\sigma_{\Sigma,n}^2 = \sum_{i=1}^{L} \sigma_{i,n}^2 = \sum_{i=1}^{L} \frac{\sigma_i^2}{\sigma_e^2}$$

---

## 3.3. Гранични цикли с ниски нива

### Характеристики

**Наричат се още:**

- Zero-input limit cycles
- Granular limit cycles
- Dead band effect

**Условия за възникване:**

- Неизменна амплитуда на входа
- Слаб входен сигнал
- Липса на входен сигнал

### Мъртва зона (Dead Band)

**Формула на Джаксън (за звено от II ред):**

$$A_{max} = \frac{\delta}{2(1 - |a_1| - |a_2|)} = \frac{2^{-B}}{2(1 - \sqrt{a_1^2 + 4a_2})}$$

където $H(z) = \frac{N(z)}{1 + a_1z^{-1} + a_2z^{-2}}$

### Методи за намаляване

**1. Увеличаване на B** (намаляване на δ)

**2. Отместване на полюсите** далеч от единичната окръжност

**3. Отсичане вместо закръгление**

---

## ОСНОВНИ ФОРМУЛИ

**Минимална дължина на дума:**
$$B_{min} = \log_2|\delta_p| + \log_2|\omega_p - \omega_s| + \log_2\left|\frac{2}{\omega_d \sin\frac{\omega_p}{\omega_d}}\right|$$

**Мащабиращ коефициент:**
$$K = \frac{1}{G}, \quad G = l_1 = \sum |h_i|$$

**Дисперсия на шума (КИХ):**
$$\sigma_{\Delta H}^2 = (M+1)\frac{2^{-2B}}{12}$$

**Мъртва зона:**
$$A_{max} = \frac{2^{-B}}{2(1 - \sqrt{a_1^2 + 4a_2})}$$

---

## КЛАСИФИКАЦИЯ НА ГРАНИЧНИ ЦИКЛИ

```
ГРАНИЧНИ ЦИКЛИ
├── От препълване
│   ├── Високо ниво
│   └── Неустойчиви
└── С ниски нива (гранул��рни)
    ├── Ниско ниво
    ├── Устойчиви
    └── Мъртва зона
```

---

## СРАВНЕНИЕ НА СТРУКТУРИ

| Характеристика                    | Директна  | Каскадна      |
| --------------------------------- | --------- | ------------- |
| **Чувствителност към квантуване** | Висока    | Ниска         |
| **Устойчивост след квантуване**   | Несигурна | По-добра      |
| **Мащабиране**                    | По-трудно | По-лесно      |
| **Препоръка**                     | Избягвай  | **Използвай** |

---

## ОСНОВНИ ТЕРМИНИ

- **LS1a** - Low Sensitivity звено от 1-ви ред, тип a
- **MHNS** - Minimum Half-band Noise Shaping
- **Dead band** - Мъртва зона
- **Overflow** - Препълване
- **Underflow** - Ненапълване
- **Saturation** - Насищане
- **Granular** - Зърнест, грануларен

---

## ПРАКТИЧЕСКИ СЪВЕТИ

**При проектиране:**

1. ✓ Използвай **каскадна структура**
2. ✓ Изчисли **минималната дължина B**
3. ✓ Приложи **мащабиране** (l₂-норма)
4. ✓ Използвай **суматори с насищане**
5. ✓ Тествай за **гранични цикли**

**При реализация:**

1. ✓ Избягвай полюси близо до единичната окръжност
2. ✓ Прилагай **последователно мащабиране**
3. ✓ Наблюдавай за **препълвания**

---
### Question 1
Какъв е основният ефект от квантуването на коефициентите на умножение?

A. Отместване на полюсите и нулите в z-равнината
B. Подобряване на честотната характеристика
C. Намаляване на изчислителната сложност
D. Увеличаване на реда на системата
Correct: A

### Question 2
Какъв е основният критерий за определяне на минималната дължина на двоичната дума B?

A. Отстояние на полюсите от единичната окръжност
B. Дължината на преходната област
C. Честотата на дискретизация
D. Броят на коефициенти
Correct: A

### Question 3
Кога се налага l₂-мащабиране при проектиране на цифрови системи?

A. За предотвратяване на препълване при изчисления
B. За подобряване на честотната характеристика
C. За намаляване на динамичния диапазон
D. За намаляване на фазовата изкривеност
Correct: A

### Question 4
Кой от следните ефекти е най-опасен за стабилността на системата?

A. Препълване (overflow)
B. Квантуване на произведения
C. Грануларен шум
D. Гранични цикли с ниски нива
Correct: A

### Question 5
Какво представляват граничните цикли с ниски нива?

A. Периодични колебания с малка амплитуда, причинени от квантуване
B. Големи нестабилни колебания
C. Монотонно нарастващ сигнал
D. Постоянен изходен сигнал
Correct: A

### Question 6
Коя структура е най-малко чувствителна към квантуване?

A. Каскадна структура
B. Директна структура
C. Транспонирана директна структура
D. Паралелна структура
Correct: A

### Question 7
Какво е основното предимство на каскадната структура при реализация?

A. По-ниска чувствителност към квантуване
B. По-малко изчислителни операции
C. Линейна фазова характеристика
D. По-нисък ред на системата
Correct: A

### Question 8
Какво представлява "мъртва зона" при граничните цикли?

A. Диапазон, в който системата не реагира на малки входни сигнали
B. Зона на неустойчивост
C. Зона на силни колебания
D. Зона на затихване
Correct: A

### Question 9
Какъв е основният метод за намаляване на паразитните ефекти от квантуване?

A. Увеличаване дължината на двоичната дума
B. Намаляване на честотата на дискретизация
C. Намаляване на реда на филтъра
D. Използване на по-прости аритметика
Correct: A

### Question 10
Кога е необходимо да се прилага последователно мащабиране?

A. Когато има няколко изчислителни етапа
B. Само при рекурсивни системи
C. Само при нерекурсивни системи
D. Когато честотата на дискретизация е ниска
Correct: A

### Question 11
Какво е основният проблем при квантуването на произведения?

A. Добавяне на шум към всяко произведение
B. Губа на точност при събиране
C. Забавяне на изчисленията
D. Препълване на резултата
Correct: A

### Question 12
Какво представлява линеен шумов модел за квантуване на произведения?

A. e(n) = -e₁(n) + e₂(n) + e₃(n) - e₄(n)
B. e(n) = e₁(n) + e₂(n) + e₃(n) + e₄(n)
C. e(n) = e₁(n) - e₂(n) - e₃(n) - e₄(n)
D. e(n) = e₁(n) * e₂(n) * e₃(n) * e₄(n)
Correct: A

### Question 13
Кой от следните методи помага за избягване на гранични цикли? (Select all that apply)

A. Използване на суматори с насищане
B. Мащабиране на входния сигнал
C. Избягване на полюси близо до единичната окръжност
D. Използване на по-висока точност
Correct: A, B, C

### Question 14
Какво е основното предимство на структурите с ниска чувствителност (Low Sensitivity)?

A. По-добра устойчивост след квантуване на коефициентите
B. По-малко изчислителни операции
C. Линейна фазова характеристика
D. По-нисък ред на системата
Correct: A

### Question 15
Кога е по-добре да се използва директна структура вместо каскадна?

A. Когато има достатъчно битове и не се очакват паразитни ефекти
B. Когато се изисква висока устойчивост
C. Когато имаме ограничени ресурси
D. Когато се нуждаем от линейна фаза
Correct: A

### Question 16
Какво е основният критерий за оценка на шума от квантуване?

A. Дисперсия на шума (σ²)
B. Максимална амплитуда на шума
C. Средна стойност на шума
D. Честота на шума
Correct: A

### Question 17
Кои фактори влияят на амплитудата на граничните цикли? (Select all that apply)

A. Стъпка на квантуване
B. Структура на филтъра
C. Коефициенти на филтъра
D. Честота на дискретизация
Correct: A, B, C

### Question 18
Какво представлява MHNS (Minimum Half-band Noise Shaping)?

A. Метод за минимизиране на шума при полупасови филтри
B. Вид каскадна структура
C. Метод за мащабиране
D. Вид прозоречна функция
Correct: A

### Question 19
Кой от следните параметри НЕ се влияе от квантуването на коефициентите?

A. Честотата на дискретизация
B. Разположение на полюсите
C. Амплитудно-честотна характеристика
D. Стабилност на системата
Correct: A

### Question 20
Каква е най-важната препоръка при практическа реализация на цифрови филтри?

A. Използвай каскадна структура и избягвай полюси близо до единичната окръжност
B. Използвай директна структура за по-бързи изчисления
C. Използвай минимален брой битове за по-ниска цена
D. Използвай по-висока честота на дискретизация
Correct: A
---
